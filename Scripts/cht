#!/usr/bin/env zsh

# Description: Extremely simple frontend for https://cheat.sh.
#
# Usage: cht
#        cht <query>
#
# Creator: GÃ¶ran Gustafsson (gustafsson.g at gmail.com)
# License: BSD 3-Clause

url="https://cheat.sh"
pager="nvim -R -c 'setlocal nolist | nmap q :q<CR>' -"

if [[ $# -ge 1 ]]; then
  # Replace spaces with + that is needed in the URL.
  query="${*/ /+}?T"

  # Fetch cheat page and fix some formatting issues.
  response=$(curl --no-progress-meter "${url}/$query" | \
    sed -e '/^$/N;/^\n$/D' \
        -e 's/#\[cheat/\n\n## \[cheat/g' \
        -e 's/#\[tldr/\n\n## \[tldr/g')

  echo "## ${url}/${query}\n$response" | eval $pager
else
  curl --no-progress-meter "${url}/:help"
fi
