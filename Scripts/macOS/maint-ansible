#!/usr/bin/env zsh

# Description: Executes Ansible playbook for local setup.
#
# Usage: maint-ansible
#
# Creator: GÃ¶ran Gustafsson (gustafsson.g at gmail.com)
# License: BSD 3-Clause

# TODO: Rewrite after legacy decom.
if [[ $HOST == Onett ]]; then
  playbook=setup_macos_home.yml
elif [[ $HOST == Twoson ]]; then
  playbook=setup_macos_work.yml
  git_pull=true
elif [[ $HOST == Coruscant ]]; then
  playbook=setup_macos_home_legacy.yml
else
  echo "Could not determine which Ansible playbook to use! Exiting..."
  exit 1
fi

directory=~/Projects/Ansiblebot

if [[ $git_pull == true ]]; then
  print -P "%F{cyan}git pull @ ${directory/$HOME/~}:%f"
  git -C $directory pull
  echo
fi

print -P "%F{cyan}ansible-playbook ${playbook}:%f"
confirm || exit 1
pushd $directory
ansible-playbook $playbook --ask-become
popd
